<!DOCTYPE html>
<html lang="en" ng-app="healthyLife">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <title>HealthyLife</title>
    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="http://cdn.bootcss.com/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<!-- NAVBAR
================================================== -->

<body>
    <ui-view></ui-view>
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="js/jquery-1.11.3.js"></script>
    <script src="./js/bootstrap.min.js"></script>
    <script type="text/javascript" src="./js/angular.js"></script>
    <script type="text/javascript" src="./js/angular-ui-router.js"></script>
    <script type="text/javascript">
    var healthApp = angular.module('healthyLife', ['ui.router'])
        .run(function($rootScope) {
            $rootScope.imgPrefix = "http://tnfs.tngou.net/image";
        })
        .config(function($stateProvider, $urlRouterProvider, $urlMatcherFactoryProvider) {

            $urlRouterProvider.otherwise('/navbar/home');
            $urlMatcherFactoryProvider.caseInsensitive(true);

            $stateProvider
                .state('navbar', {
                    url: '/navbar',
                    templateUrl: './template/navbar.html',
                    controller: 'navbarController'
                })
                .state('navbar.home', {
                    url: '/home',
                    templateUrl: './template/home.html',
                    controller: 'homeController'
                })
                .state('navbar.symptomList', {
                    url: '/symptomList/:id/:page',
                    templateUrl: './template/symptomList.html',
                    controller: 'symptomListController'
                })
                .state('navbar.symptomDetail', {
                    url: '/symptomDetail/:id',
                    templateUrl: './template/symptomDetail.html',
                    controller: 'symptomDetailController'
                })
        })
        .filter("myFilter", function($sce) {
            return function(input) {
                return $sce.trustAsHtml(input);
            }
        })
        .controller('navbarController', function($scope, $http) {
            $http({
                url: 'http://localhost/symptomCategories.php',
            }).then(function(res) {
                console.log(res)
                $scope.symptomCates = res.data.tngou;
            })
        })
        .controller('homeController', function($scope) {
            $scope.welcome = "欢迎来到健康小助手之家";
        })
        .controller('symptomListController', function($scope, $stateParams, $http) {
            $http({
                url: 'http://localhost/symptomList.php',
                params: {
                    id: $stateParams.id,
                    page: $stateParams.page
                }
            }).then(function(res) {
                console.log(res);
                $scope.symptomLists = res.data.list;
                var pageCountList = [];
                var rows = 15;

                for (var i = 1; i <= Math.ceil(res.data.total / rows); i++) {
                    pageCountList.push(i);
                }
                console.log(res)
                $scope.id = $stateParams.id;
                $scope.pageCountList = pageCountList;
                console.log(pageCountList);
            })
        })
        .controller('symptomDetailController', function($scope, $stateParams, $http) {
            $http({
                url: 'http://localhost/symptomDetail.php',
                params: {
                    id: $stateParams.id
                }
            }).then(function(res) {
                $scope.symptomDetail = res.data;
                console.log(res);
            })
        })
    </script>
</body>

</html>
